<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Portal de Procedimentos | Somauma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root {
      --bg: #bdf0d3;
      --card-bg: #ffffff;
      --accent: #00695c;
      --accent-soft: #e0f2f1;
      --text-main: #111827;
      --text-soft: #6b7280;
      --border-soft: #e5e7eb;
      --radius-lg: 14px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text-main);
    }

    .container {
      max-width: 1080px;
      margin: 32px auto;
      padding: 0 16px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    h1, h2, h3 {
      margin-top: 0;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
    }

    h2 {
      font-size: 1.4rem;
    }

    p {
      margin-top: 0;
      line-height: 1.5;
    }

    .hidden {
      display: none;
    }

    .error {
      color: #b00020;
      margin-top: 12px;
      font-size: 0.9rem;
    }

    .login-header {
      margin-bottom: 16px;
    }

    .login-subtitle {
      color: var(--text-soft);
      font-size: 0.95rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: var(--accent-soft);
      color: var(--accent);
      margin-bottom: 12px;
    }

    .user-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      padding: 10px 14px;
      border-radius: 999px;
      background: #f3f4f6;
      font-size: 0.9rem;
    }

    .user-bar span {
      color: var(--text-soft);
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.85rem;
      cursor: pointer;
      background: #111827;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-soft);
      border: 1px solid var(--border-soft);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 18px;
    }

    .filters select,
    .filters input {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      font-size: 0.9rem;
      min-width: 180px;
      outline: none;
    }

    .filters select:focus,
    .filters input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(0, 105, 92, 0.15);
    }

    .procedures-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 18px;
    }

    .procedure-card {
      border-radius: 16px;
      border: 1px solid var(--border-soft);
      padding: 14px;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      gap: 10px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.08s ease;
    }

    .procedure-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
      border-color: rgba(148, 163, 184, 0.8);
    }

    .procedure-thumb {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 12px;
      object-fit: cover;
      background: #e5e7eb;
      display: block;
    }

    .procedure-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--text-soft);
      gap: 8px;
      flex-wrap: wrap;
    }

    .procedure-dept {
      padding: 3px 9px;
      border-radius: 999px;
      background: #f3f4f6;
      font-weight: 500;
    }

    .procedure-title {
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
    }

    .procedure-summary {
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    .procedure-actions {
      margin-top: auto;
      display: flex;
      justify-content: flex-end;
    }

    .procedure-actions a {
      text-decoration: none;
    }

    .empty-state {
      text-align: center;
      padding: 24px 12px;
      color: var(--text-soft);
      font-size: 0.9rem;
      border-radius: 16px;
      border: 1px dashed var(--border-soft);
      margin-top: 12px;
    }

    @media (max-width: 640px) {
      .container {
        margin: 20px auto;
      }
      .card {
        padding: 18px;
      }
      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LOGIN -->
    <div id="login-section" class="card">
      <div class="badge">Acesso restrito Â· somauma.com</div>
      <div class="login-header">
        <h1>Portal de Procedimentos</h1>
        <p class="login-subtitle">
          FaÃ§a login com o seu e-mail <strong>@somauma.com</strong> para acessar e baixar os procedimentos internos.
        </p>
      </div>

      <div id="g_id_onload"
        data-client_id="1015680568136-svgn7b59p1j7um8naqchs1r1eh99s02l.apps.googleusercontent.com"
        data-callback="handleCredentialResponse"
        data-auto_select="false"
        data-itp_support="true">
      </div>

      <div class="g_id_signin"
        data-type="standard"
        data-size="large"
        data-theme="outline"
        data-text="signin_with"
        data-shape="rectangular"
        data-logo_alignment="left">
      </div>

      <div id="login-error" class="error hidden"></div>
    </div>

    <!-- PORTAL PROTEGIDO -->
    <div id="portal-section" class="card hidden">
      <div class="badge">Portal interno Â· Somauma</div>
      <h2>Procedimentos por departamento</h2>

      <div class="user-bar">
        <span id="user-info"></span>
        <button class="btn btn-ghost" id="logout-btn">Sair</button>
      </div>

      <div class="filters">
        <select id="deptFilter">
          <option value="todos">Todos os departamentos</option>
          <option value="JurÃ­dico">JurÃ­dico</option>
          <option value="Financeiro">Financeiro</option>
          <option value="Comercial">Comercial</option>
          <option value="OperaÃ§Ãµes">OperaÃ§Ãµes</option>
          <option value="RH">RH</option>
        </select>

        <input
          type="text"
          id="searchInput"
          placeholder="Buscar por tÃ­tulo ou resumo..."
        />
      </div>

      <div id="procedures-grid" class="procedures-grid"></div>
      <div id="empty-state" class="empty-state hidden">
        Nenhum procedimento encontrado com os filtros atuais.
      </div>
    </div>
  </div>

  <script>
    const ALLOWED_DOMAIN = "somauma.com";

    // Lista de procedimentos (EXEMPLO)
    // âžœ Troque pelos seus PDFs reais e thumbs
    const procedures = [
      {
        id: 1,
        department: "JurÃ­dico",
        title: "PolÃ­tica de Assinatura de Contratos",
        date: "2025-01-10",
        summary: "Passo a passo para conferÃªncia, aprovaÃ§Ã£o e assinatura de contratos com clientes e fornecedores.",
        thumbnail: "assets/thumbs/juridico-contratos.png",
        fileUrl: "assets/pdfs/juridico-politica-assinatura-contratos.pdf"
      },
      {
        id: 2,
        department: "Financeiro",
        title: "Procedimento de Contas a Pagar",
        date: "2025-01-05",
        summary: "Fluxo completo de recebimento, validaÃ§Ã£o, aprovaÃ§Ã£o e pagamento de notas fiscais.",
        thumbnail: "assets/thumbs/financeiro-contas-pagar.png",
        fileUrl: "assets/pdfs/financeiro-contas-a-pagar.pdf"
      },
      {
        id: 3,
        department: "Comercial",
        title: "Onboarding de Novos Clientes",
        date: "2024-12-20",
        summary: "Roteiro de onboarding, responsabilidades e prazos para novos clientes aprovados.",
        thumbnail: "assets/thumbs/comercial-onboarding.png",
        fileUrl: "assets/pdfs/comercial-onboarding-clientes.pdf"
      }
      // âžœ Adicione mais objetos aqui
    ];

    // --- AutenticaÃ§Ã£o Google ---

    function parseJwt (token) {
      const parts = token.split('.');
      if (parts.length !== 3) return null;
      const payload = parts[1]
        .replace(/-/g, '+')
        .replace(/_/g, '/');
      const decoded = atob(payload);
      try {
        return JSON.parse(decoded);
      } catch (e) {
        console.error("Erro ao parsear token:", e);
        return null;
      }
    }

    function handleCredentialResponse(response) {
      const token = response.credential;
      const data = parseJwt(token);

      if (!data) {
        showError("NÃ£o foi possÃ­vel validar o login. Tente novamente.");
        return;
      }

      const email = data.email;
      const hd = data.hd;
      const domainFromEmail = email.split("@")[1];

      if (domainFromEmail !== ALLOWED_DOMAIN && hd !== ALLOWED_DOMAIN) {
        showError("Este portal Ã© restrito a usuÃ¡rios do domÃ­nio " + ALLOWED_DOMAIN + ".");
        return;
      }

      showPortal(email);
    }

    function showError(msg) {
      const errorDiv = document.getElementById("login-error");
      errorDiv.textContent = msg;
      errorDiv.classList.remove("hidden");
    }

    function showPortal(email) {
      const loginSection = document.getElementById("login-section");
      const portalSection = document.getElementById("portal-section");
      const userInfo = document.getElementById("user-info");

      loginSection.classList.add("hidden");
      portalSection.classList.remove("hidden");

      userInfo.textContent = "Logado como: " + email;

      renderProcedures(); // Renderiza a primeira vez
    }

    document.getElementById("logout-btn").addEventListener("click", () => {
      if (window.google && google.accounts && google.accounts.id) {
        google.accounts.id.disableAutoSelect();
      }
      window.location.reload();
    });

    // --- RenderizaÃ§Ã£o dos procedimentos ---

    const deptFilterEl = document.getElementById("deptFilter");
    const searchInputEl = document.getElementById("searchInput");
    const gridEl = document.getElementById("procedures-grid");
    const emptyStateEl = document.getElementById("empty-state");

    function formatDate(isoDate) {
      // Converte AAAA-MM-DD em DD/MM/AAAA
      const [year, month, day] = isoDate.split("-");
      return `${day}/${month}/${year}`;
    }

    function renderProcedures() {
      const deptFilter = deptFilterEl.value;
      const searchTerm = searchInputEl.value.trim().toLowerCase();

      gridEl.innerHTML = "";

      const filtered = procedures.filter(p => {
        const matchesDept =
          deptFilter === "todos" || p.department === deptFilter;

        const text = (p.title + " " + p.summary).toLowerCase();
        const matchesSearch = searchTerm === "" || text.includes(searchTerm);

        return matchesDept && matchesSearch;
      });

      if (filtered.length === 0) {
        emptyStateEl.classList.remove("hidden");
        return;
      } else {
        emptyStateEl.classList.add("hidden");
      }

      filtered
        // Ordena por data desc
        .sort((a, b) => (a.date < b.date ? 1 : -1))
        .forEach(p => {
          const card = document.createElement("div");
          card.className = "procedure-card";

          card.innerHTML = `
            <img
              src="${p.thumbnail}"
              alt="Thumbnail do procedimento"
              class="procedure-thumb"
              onerror="this.style.display='none';"
            />
            <div class="procedure-meta">
              <span class="procedure-dept">${p.department}</span>
              <span>${formatDate(p.date)}</span>
            </div>
            <h3 class="procedure-title">${p.title}</h3>
            <p class="procedure-summary">${p.summary}</p>
            <div class="procedure-actions">
              <a href="${p.fileUrl}" target="_blank" rel="noopener noreferrer">
                <button class="btn">
                  ðŸ“„ Baixar PDF
                </button>
              </a>
            </div>
          `;

          gridEl.appendChild(card);
        });
    }

    deptFilterEl.addEventListener("change", renderProcedures);
    searchInputEl.addEventListener("input", renderProcedures);
  </script>
</body>
</html>
